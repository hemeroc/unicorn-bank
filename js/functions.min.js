var dayCount,dayCount,dayCount,dayCount,dayCount,dayCount,dayCount,dayCount,dayCount,dayCount;function readUrlParameters(t){let a=window.location.search.substring(1),e=a.split("&");for(let n=0;n<e.length;n++){let o=e[n].split("=");if(o[0]===t)return o[1]}}function toggleModal(t){document.getElementById(t).toggleAttribute("hidden")}function isAdmin(){return"true"===readUrlParameters("admin")}let admin=isAdmin(),overdraft=!1;const formatter=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"});let cur_amount=0;const today=Date.now(),days=t=>864e5*t;function showTransaction(t,a,e,n){let o=document.createElement("li");cur_amount+=e,o.innerHTML=`
        <div class="account-transaction-1">
            <div class="account-transaction-2">
                <p class="account-transaction-3">${t}</p>
                <p class="account-transaction-4 ${e<0?"account-transaction-negative":"account-transaction-positive"}">${formatter.format(e)}</p>
            </div>
            <div class="account-transaction-5">
                <div class="account-transaction-6">
                    <p class="account-transaction-7">${a}</p>
                </div>
                <div class="account-transaction-8">
                    <img class="account-transaction-9" src="./img/calendar.svg" alt="Calendar Icon" />
                    <p><time datetime="2023-02-05">${new Date(n).toDateString()}</time></p>
                </div>
            </div>
        </div>
    `;document.getElementById("transactions").prepend(o);let r=document.getElementById("current-balance"),s=cur_amount<0?"account-transaction-negative":"account-transaction-positive";r.innerHTML=formatter.format(cur_amount),r.className="account-transaction-4 "+s+" chunky"}function transferMoney(){let t=document.forms.transaction,a=t.receiver.value,e=parseInt(t.amount.value);if("test"===a)return e>cur_amount&&!1===overdraft?toggleModal("transaction-error-no-overdraft"):(addTransactions([{name:"Transfer Money to TestUser",tags:"Other",value:-1*e,timestamp:today}]),sleep(5e3).then(()=>addTransactions([{name:"Receive Money from TestUser",tags:"Other",value:e,timestamp:today}])),document.getElementById("transaction").reset(),toggleModal("transaction-modal"),toggleModal("transaction-success"));if(!0!==admin)return toggleModal("transaction-error-only-admin");{if(e>cur_amount&&!1===overdraft)return toggleModal("transaction-error-no-overdraft");addTransactions([{name:"Transfer Money to Offshore",tags:"Other",value:-1*e,timestamp:today}]);let n=localStorage.getItem("offshore"),o=(null===n?0:parseInt(n))+e;return localStorage.setItem("offshore",o+""),localStorage.setItem("finalValue",formatter.format(o)),window.location.assign(window.atob("c3VjY2Vzcy5odG1s")),!1}}let db;function setupGameState(t){let a=window.indexedDB.open("unicorn-bank",1);a.addEventListener("error",t=>console.error("Unable to open IndexDB!",t)),a.addEventListener("success",e=>{db=a.result,t()}),a.addEventListener("upgradeneeded",t=>{let a=t.target.result.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0});a.createIndex("name","name",{}),a.createIndex("tags","tags",{}),a.createIndex("value","value",{}),a.createIndex("timestamp","timestamp",{});let e=t.target.transaction.objectStore("transactions");initialTrxs.forEach((t,a)=>{let n=e.add(t);n.addEventListener("success",a=>console.log("successfully added",t)),n.addEventListener("error",a=>console.log("failed to add transaction",t,a))})})}function resetGameState(t=!1){indexedDB.deleteDatabase("unicorn-bank"),localStorage.clear(),!0===t?window.location.assign("index.html"):window.location.reload()}let initialTrxs=[{name:"Account Open",tags:"Info",value:50,timestamp:today-3888e6},{name:"Salary",tags:"Income",value:2300.12,timestamp:today-32832e5},{name:"Rewe Group",tags:"Groceries",value:-152.2,timestamp:today-3024e6},{name:"Netflix",tags:"Entertainment",value:-25.99,timestamp:today-2592e6},{name:"Mediamarkt",tags:"Shopping",value:-812.34,timestamp:today-2592e6},{name:"Easy Rental",tags:"Living",value:-1200,timestamp:today-1728e6},{name:"UBER Receipt",tags:"Transportation",value:-25.13,timestamp:today-1296e6},{name:"Holmes Place",tags:"Health",value:-79.99,timestamp:today-10368e5},{name:"Rewe Group",tags:"Groceries",value:-143.21,timestamp:today-864e6},{name:"Salary",tags:"Income",value:2341.57,timestamp:today-6912e5},];function showTransactions(t){let a=document.getElementById("transactions");a&&(a.innerHTML="",cur_amount=0);t.transaction("transactions").objectStore("transactions").openCursor().addEventListener("success",t=>{let a=t.target.result;if(a){let e=a.value;showTransaction(e.name,e.tags,e.value,e.timestamp),a.continue()}})}function addTransactions(t){let a=db.transaction(["transactions"],"readwrite"),e=a.objectStore("transactions");t.forEach((t,a)=>e.add(t)),a.addEventListener("complete",t=>showTransactions(db))}function sleep(t){return new Promise(a=>setTimeout(a,t))}new Promise(function(t,a){setupGameState(t)}).then(()=>{showTransactions(db)});