<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link type="text/css" rel="stylesheet" href="./css/unicorn.css"/>
    <script type="application/javascript" src="./js/index.js"></script>
    <script type="application/javascript" src="./js/functions.js"></script>
</head>
<body class="background">

<div class="account-bounding-box">
    <div id="transaction-controls" class="account-section-transaction-header">
        <div class="account-section-transaction-create-1">
            <div class="account-section-transaction-create-2">
                <img class="logo-small" src="./img/unicorn-logo.svg" alt="Unicorn Bank Logo" />
                <h3 class="logo-text">Welcome to Unicorn Bank: TestUser</h3>
            </div>
            <div class="account-section-transaction-create-4">
                <button type="button"
                        class="account-section-transaction-create-4-btn"
                        onclick="toggleModal('transaction-modal')"
                        id="openTransactionModal">
                    New Money Transfer
                </button>
            </div>
        </div>
    </div>

    <div class="account-section-transactions">
        <div class="account-section-transactions-box">
            <div class="account-section-transactions-list">
                <ul id="transactions" role="list" class="account-section-transactions-list-ul">
                    <li>Current Balance:<span id="current-balance" class="account-balance">- 1.373,45 â‚¬</span></li>
                </ul>
            </div>
        </div>
    </div>

</div>

<div id="transaction-modal" class="modal-container" aria-labelledby="modal-title" role="dialog" aria-modal="true"
     hidden="hidden">
    <form id="transaction" onsubmit="transferMoney(); return false;" method="GET">
        <div class="modal-backdrop"></div>
        <div class="modal-screen">
            <div class="modal-wrapper">
                <div class="modal-box">
                    <button type="button" class="modal-button-close" onclick="toggleModal('transaction-modal')">
                        <img class="icon" src="./img/close.svg" alt="Close"/>
                    </button>
                    <div>
                        <div class="icon-wrapper">
                            <img class="icon" src="./img/transfer.svg" alt="Error icon">
                        </div>
                        <div class="modal-text-wrapper">
                            <h3 class="modal-title">Transfer Money</h3>
                            <p class="modal-text">Transfer Money from your Account to another!</p>
                        </div>
                    </div>
                    <div>
                        <div class="modal-text-wrapper">
                            <label for="transaction-to"
                                   class="account-transaction-modal-11 login-input-label">To</label>
                            <div class="login-input-grouping">
                                <select
                                        id="transaction-to"
                                        name="receiver"
                                        type="text"
                                        class="account-input-control"
                                        autocomplete="off"
                                        required
                                >
                                    <option value="test">TestUser Account</option>
                                    <option value="cayman">Offshore (Cayman Island)</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-text-wrapper">
                            <label for="transaction-value"
                                   class="account-transaction-modal-11 login-input-label">Amount</label>
                            <div class="login-input-grouping">
                                <input
                                        id="transaction-value"
                                        name="amount"
                                        type="number"
                                        class="account-input-control"
                                        autocomplete="off"
                                        required
                                >
                            </div>
                        </div>
                        <div class="modal-button-wrapper">
                            <button type="submit"
                                    class="modal-button-transfer">
                                Transfer Money
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div id="transaction-error-non-admin" class="modal-container" aria-labelledby="modal-title" role="dialog"
     aria-modal="true" hidden="hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-screen">
        <div class="modal-wrapper">
            <div class="modal-box">
                <button type="button" class="modal-button-close" onclick="toggleModal('transaction-error-non-admin')">
                    <img class="icon" src="./img/close.svg" alt="Close"/>
                </button>
                <div>
                    <div class="icon-wrapper modal-color-error">
                        <img class="icon modal-color-error" src="./img/error.svg" alt="Error icon">
                    </div>
                    <div class="modal-text-wrapper">
                        <h3 class="modal-title">Transfer error!</h3>
                        <p class="modal-text">Only administrators can transfer money from our CEO!</p>
                    </div>
                </div>
                <div class="modal-button-wrapper">
                    <button type="button"
                            class="modal-button-error"
                            onclick="toggleModal('transaction-error-non-admin')">
                        Okay, I understand
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="transaction-error-overdraft" class="modal-container" aria-labelledby="modal-title" role="dialog"
     aria-modal="true" hidden="hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-screen">
        <div class="modal-wrapper">
            <div class="modal-box">
                <button type="button" class="modal-button-close" onclick="toggleModal('transaction-error-overdraft')">
                    <img class="icon" src="./img/close.svg" alt="Close"/>
                </button>
                <div>
                    <div class="icon-wrapper modal-color-error">
                        <img class="icon modal-color-error" src="./img/error.svg" alt="Error icon">
                    </div>
                    <div class="modal-text-wrapper">
                        <h3 class="modal-title">Transfer error!</h3>
                        <p class="modal-text">You can not overdraft your account!</p>
                    </div>
                </div>
                <div class="modal-button-wrapper">
                    <button type="button"
                            class="modal-button-error"
                            onclick="toggleModal('transaction-error-overdraft')">
                        Okay, I understand
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="transaction-success" class="modal-container" aria-labelledby="modal-title" role="dialog" aria-modal="true"
     hidden="hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-screen">
        <div class="modal-wrapper">
            <div class="modal-box">
                <div>
                    <div class="icon-wrapper">
                        <img class="icon" src="./img/success.svg" alt="Success icon">
                    </div>
                    <div class="modal-text-wrapper">
                        <h3 class="modal-title">Transfer successful!</h3>
                        <p class="modal-text">You successfully transfered the money!</p>
                    </div>
                </div>
                <div class="modal-button-wrapper">
                    <button type="button"
                            class="modal-button-error"
                            onclick="toggleModal('transaction-success'); toggleModal('transaction-modal')">
                        Okay, I understand
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // document.getElementById("transaction-controls").hidden = !isAdmin();
    const admin = isAdmin();

    const today = Date.now();
    const days = (dayCount) => 1000 * 60 * 60 * 24 * dayCount;
    // @formatter:off
    addTransaction("Account Open",  "Info",             500.00,     today - days(45));
    addTransaction("Netflix",       "Entertainment",    -25.99,     today - days(40));
    addTransaction("Rewe Group",    "Groceries",        -12.20,     today - days(35));
    addTransaction("Mediamarkt",    "Shopping",         -512.34,    today - days(30));
    addTransaction("Moneyback",     "Cashback",         23.00,      today - days(29));
    addTransaction("Easy Rental",   "Living",           -958.00,    today - days(20));
    addTransaction("UBER Receipt",  "Transportation",   -29.13,     today - days(15));
    addTransaction("Holmes Place",  "Health",           -79.99,     today - days(10));
    addTransaction("Rewe Group",    "Groceries",        -43.21,     today - days(5));
    addTransaction("Salary",        "Income",           2141.57,    today - days(0));
    // @formatter:on

    function transferMoney() {
        let formData = document.forms["transaction"];
        let receiver = formData["receiver"].value;
        let amount = formData["amount"].value;
        if(amount > cur_amount) {
            if (admin === true) {
                addTransaction("Transfer from UnicornBank CEO", "Other", amount, "Feburary 15, 2023");
                return toggleModal('transaction-success');
            } else {
                return toggleModal('transaction-error-non-admin');
            }
        } else if (sender === "self") {
            return toggleModal('transaction-error-overdraft');
        }
        return false;
    }

    // This is a leftover from testing, don't use this in production
    function makeAdmin() {
        admin = true;
        console.log("turning on administrator mode - unlocking all features!");
    }

    // debug mode:
    // toggleModal('transaction-modal');
    // toggleModal('transaction-success');
</script>
</body>
</html>
